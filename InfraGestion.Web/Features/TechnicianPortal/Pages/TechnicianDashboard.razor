@page "/technician/dashboard"
@using InfraGestion.Web.Features.Auth.Services
@inject AuthService AuthService

<PageTitle>Dashboard Técnico - InfraCom</PageTitle>

<h1 class="page-title">Dashboard</h1>

<div class="dashboard-content">
        <!-- Quick Actions Section -->
        <div class="quick-actions-card">
            <h2 class="card-title">Acciones Rápidas</h2>
            <div class="action-buttons">
                <button class="btn-action btn-primary" @onclick="RegisterMaintenance">
                    <svg class="btn-icon" viewBox="0 0 256 256" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <!-- ICON: Put your "+" or maintenance icon path here -->
                        <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"/>
                    </svg>
                    Registrar Mantenimiento
                </button>
                <button class="btn-action btn-danger" @onclick="CreateDecommissionRequest">
                    <svg class="btn-icon" viewBox="0 0 256 256" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                        <!-- ICON: Put your "+" or request icon path here -->
                        <path d="M224,128a8,8,0,0,1-8,8H136v80a8,8,0,0,1-16,0V136H40a8,8,0,0,1,0-16h80V40a8,8,0,0,1,16,0v80h80A8,8,0,0,1,224,128Z"/>
                    </svg>
                    Crear solicitud de baja
                </button>
            </div>
        </div>

        <!-- Pending Initial Defect Requests Section -->
        <div class="pending-requests-card">
            <h2 class="card-title">Solicitudes de Defectación Inicial pendientes</h2>
            
            @if (isLoading)
            {
                <div class="loading-state">Cargando solicitudes...</div>
            }
            else if (!pendingRequests.Any())
            {
                <div class="empty-state">No hay solicitudes pendientes</div>
            }
            else
            {
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>FECHA EMISIÓN</th>
                                <th>ID EQUIPO</th>
                                <th>SOLICITANTE</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var request in pendingRequests)
                            {
                                <tr>
                                    <td>@request.EmissionDate.ToString("dd/MM/yyyy")</td>
                                    <td>@request.EquipmentId</td>
                                    <td>@request.RequesterName</td>
                                    <td>
                                        <button class="btn-icon-action" @onclick="() => EditRequest(request.Id)" title="Editar">
                                            <svg class="action-icon" viewBox="0 0 256 256" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                                <!-- ICON: Put your edit/pencil icon path here -->
                                                <path d="M229.66,58.34l-32-32a8,8,0,0,0-11.32,0l-96,96A8,8,0,0,0,88,128v32a8,8,0,0,0,8,8h32a8,8,0,0,0,5.66-2.34l96-96A8,8,0,0,0,229.66,58.34ZM124.69,152H104V131.31l64-64L188.69,88ZM200,76.69,179.31,56,192,43.31,212.69,64ZM224,128v80a16,16,0,0,1-16,16H48a16,16,0,0,1-16-16V48A16,16,0,0,1,48,32h80a8,8,0,0,1,0,16H48V208H208V128a8,8,0,0,1,16,0Z"/>
                                            </svg>
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>

@code {
    private bool isLoading = true;
    private List<PendingRequest> pendingRequests = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadPendingRequests();
    }

    private async Task LoadPendingRequests()
    {
        isLoading = true;
        
        // TODO: Implement real service call when available
        // For now, using sample data
        await Task.Delay(500); // Simulate loading
        
        pendingRequests = new List<PendingRequest>
        {
            new PendingRequest
            {
                Id = 1,
                EmissionDate = new DateTime(2023, 12, 20),
                EquipmentId = "DEV001",
                RequesterName = "Alejandro Torres"
            }
        };
        
        isLoading = false;
    }

    private void RegisterMaintenance()
    {
        // TODO: Navigate to maintenance registration page
        Console.WriteLine("Register Maintenance");
    }

    private void CreateDecommissionRequest()
    {
        // TODO: Navigate to create decommission request page
        Console.WriteLine("Create decommission request");
    }

    private void EditRequest(int requestId)
    {
        // TODO: Navigate to edit request page
        Console.WriteLine($"Edit request {requestId}");
    }

    // Temporary model - move to Models when integrating with backend
    private class PendingRequest
    {
        public int Id { get; set; }
        public DateTime EmissionDate { get; set; }
        public string EquipmentId { get; set; } = string.Empty;
        public string RequesterName { get; set; } = string.Empty;
    }
}
